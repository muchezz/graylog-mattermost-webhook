version: '3.8'

services:
  # Graylog Mattermost Webhook Service
  graylog-mattermost-webhook:
    build: .
    container_name: graylog-mattermost-webhook
    ports:
      - "8080:8080"
    environment:
      # Required: Your Mattermost incoming webhook URL
      MATTERMOST_WEBHOOK_URL: "https://mattermost.example.com/hooks/your-webhook-id"
      
      # Optional configuration
      MATTERMOST_USERNAME: "Graylog Alerts"
      MATTERMOST_CHANNEL: "#alerts"
      LISTEN_ADDR: "0.0.0.0:8080"
      LOG_LEVEL: "info"
      
      # Uncomment to use dry-run mode (logs instead of posting)
      # DRY_RUN: "true"
    
    volumes:
      # Optional: Mount config file
      # - ./config.yaml:/app/config.yaml
      - ./logs:/app/logs
    
    restart: unless-stopped
    
    # Health check
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s
    
    networks:
      - graylog-network
    
    labels:
      - "com.example.description=Graylog to Mattermost Webhook Bridge"

networks:
  graylog-network:
    driver: bridge
